async swapTokenOnSolana(
    privateKey: string,
    inputMint: string,
    outputMint: string,
    trade: Record<string, any>,
    connection: solanaWeb3.Connection
): Promise < string | null > {
    if(!privateKey) {
        console.error("âŒ Missing private key. Aborting swap.");
        return null;
    }

        if(!trade || !trade.ct_amount) {
    console.error("âŒ Invalid trade object. Aborting swap.");
    return null;
}

// âœ… 1. Khá»Ÿi táº¡o vÃ­ tá»« private key
const payerKeypair = await this.getSolanaKeypair(privateKey);
console.log(`ğŸ”¹ Using wallet: ${payerKeypair.publicKey.toBase58()}`);

// âœ… 2. Program ID cá»§a Raydium (ÄÃ£ kiá»ƒm tra executable)
const RAYDIUM_PROGRAM_ID = new solanaWeb3.PublicKey("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C");
const programInfo = await connection.getAccountInfo(RAYDIUM_PROGRAM_ID);

if (!programInfo || !programInfo.executable) {
    console.error("âŒ Program ID khÃ´ng tá»“n táº¡i hoáº·c khÃ´ng thá»ƒ truy cáº­p.");
    return null;
}

console.log("âœ… Program ID há»£p lá»‡ vÃ  cÃ³ thá»ƒ truy cáº­p.");

// âœ… 3. TÃ¬m pool swap cá»§a token X vá»›i Y
const swapPoolAddress = await this.getSwapPoolAddress(inputMint, outputMint);
if (!swapPoolAddress) {
    console.error(`âš ï¸ No swap pool found for ${inputMint} â†” ${outputMint}. Aborting swap.`);
    return null;
}

console.log(`âœ… Found swap pool: ${swapPoolAddress.toBase58()}`);

// âœ… 4. Táº¡o instruction swap token trÃªn Raydium
const instructionIdentifier = Buffer.from([0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]); // Swap ID chuáº©n
const amountBuffer = Buffer.alloc(8);
amountBuffer.writeBigUInt64LE(BigInt(trade.ct_amount * solanaWeb3.LAMPORTS_PER_SOL));

const swapInstruction = new solanaWeb3.TransactionInstruction({
    programId: RAYDIUM_PROGRAM_ID,
    keys: [
        { pubkey: payerKeypair.publicKey, isSigner: true, isWritable: true },
        { pubkey: swapPoolAddress, isSigner: false, isWritable: true },
        { pubkey: new solanaWeb3.PublicKey(inputMint), isSigner: false, isWritable: true },
        { pubkey: new solanaWeb3.PublicKey(outputMint), isSigner: false, isWritable: true },
    ],
    data: Buffer.concat([instructionIdentifier, amountBuffer]),
});

try {
    // âœ… 5. Gá»­i giao dá»‹ch lÃªn máº¡ng Solana
    const transaction = new solanaWeb3.Transaction().add(swapInstruction);
    const signature = await solanaWeb3.sendAndConfirmTransaction(connection, transaction, [payerKeypair]);

    console.log(`âœ… Swap successful! Transaction Hash: ${signature}`);
    return signature;
} catch (error) {
    console.error("âŒ Swap tháº¥t báº¡i.");

    if (error instanceof solanaWeb3.SendTransactionError) {
        console.log("ğŸ” Chi tiáº¿t lá»—i giao dá»‹ch:", error.message);
        const txid = (error as any)?.signature || null;

        if (txid) {
            const txStatus = await connection.getSignatureStatus(txid);
            console.log(`ğŸ“ Tráº¡ng thÃ¡i giao dá»‹ch cho ${txid}:`, txStatus);
        } else {
            console.warn("âš ï¸ KhÃ´ng thá»ƒ láº¥y signature Ä‘á»ƒ kiá»ƒm tra tráº¡ng thÃ¡i.");
        }

        // Láº¥y logs chi tiáº¿t
        if ((error as any)?.getLogs) {
            const logs = await(error as any).getLogs(connection);
            if (logs) {
                console.error("ğŸ“ Logs giao dá»‹ch:");
                logs.forEach((log: string) => console.error(`ğŸš€ ${log}`));
            } else {
                console.warn("âš ï¸ KhÃ´ng thá»ƒ láº¥y logs tá»« giao dá»‹ch.");
            }
        }
    } else {
        console.error("âŒ Lá»—i khÃ´ng xÃ¡c Ä‘á»‹nh:", error);
    }

    return null;
}
    }